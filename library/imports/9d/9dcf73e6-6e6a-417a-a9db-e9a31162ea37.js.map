{"version":3,"sources":["../../../../../assets/resources/scripts/assets/resources/scripts/player.js"],"names":["cc","Class","extends","Component","properties","bulletType","default","serializable","bulletMap","displayName","type","Prefab","shootingInterval","lifeValue","health","get","onLoad","bulletPoolMap","map","prefab","name","replace","m","$1","toLocaleUpperCase","forEach","index","createBulletPool","timer","isBlowUp","node","on","event","console","log","update","dt","shoot","bleed","runBlowUpAnim","getComponent","Animation","play","poolName","Count","NodePool","i","instantiate","player","put","bulletPool","bulletPrefab","bulletNode","size","parent","addChild","position","x","y","setPosition","v2","fly","switchBulletType"],"mappings":"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","file":"player.js","sourceRoot":"../../../../../assets/resources/scripts","sourcesContent":["/**\n * 玩家飞机组件\n */\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        bulletType: {\n          default: 0, // ['普通子弹', '双弹道子弹']\n          serializable: false\n        },\n        bulletMap: {\n            default:[],\n            displayName: \"子弹预设\",\n            type:[cc.Prefab]\n        },\n        shootingInterval: {\n            default: 0.2,\n            displayName: \"攻击间隔\",\n        },\n        lifeValue: {\n            default: 2,\n            displayName: \"生命值\",\n        },\n        health: {\n            get: function() {\n                return (this.lifeValue !== 0)\n            }\n        }\n    },\n\n    onLoad () {\n        this.bulletPoolMap = this.bulletMap.map(prefab => {\n            return prefab.name.replace(/-([a-z])/g, (m, $1) => $1.toLocaleUpperCase()) + 'Pool';\n        });\n        this.bulletPoolMap.forEach((name, index) => {\n            this.createBulletPool(name, 20, index, this.bulletMap[index]);\n        });\n        this.timer = 0;\n        this.isBlowUp = false;\n\n        this.node.on('touchstart', function ( event ) {\n            console.log('touchstart');\n        });\n    },\n\n    update(dt) {\n      if (this.timer >= this.shootingInterval) {\n        this.shoot();\n        this.timer = 0;\n        return;\n      }\n      this.timer += dt;\n    },\n    /**\n     * 消耗血量\n     * @return {[type]} [description]\n     */\n    bleed() {\n        this.lifeValue--;\n        if(!this.health) {\n            this.runBlowUpAnim();\n        }\n    },\n    /**\n     * 炸毁动画\n     * @return {[type]} [description]\n     */\n    runBlowUpAnim() {\n        this.getComponent(cc.Animation).play('blowUp');\n        this.isBlowUp = true;\n    },\n    /**\n     * 创建子弹对应的对象池\n     * @param  {String}    poolName 对象池名称\n     * @param  {Number}    Count    对象池容量\n     * @param  {cc.Prefab} Prefab   预设对象\n     * @return {undefined}\n     */\n    createBulletPool(poolName, Count, type, Prefab) {\n      this[poolName] = new cc.NodePool();\n      for (let i = 0; i < Count; ++i) {\n        let node = cc.instantiate(Prefab);\n        node.getComponent(\"bullet\").player = this;\n        node.getComponent(\"bullet\").type = type;\n        this[poolName].put(node);\n      }\n    },\n\n    /**\n     * 射击(向父节点添加子弹节点)\n     * @return {undefined}\n     */\n    shoot() {\n        if (!this.isBlowUp) {\n            let bulletPool = this[this.bulletPoolMap[this.bulletType]];\n            let bulletPrefab = this.bulletMap[this.bulletType];\n            let bulletNode = bulletPool.size() > 0\n                            ? bulletPool.get()\n                            : cc.instantiate(bulletPrefab);\n\n            // 挂载节点\n            this.node.parent.addChild(bulletNode);\n            // 获取玩家飞机定位确定起始位置并执行动画\n            let { position: { x, y } } = this.node;\n            bulletNode.setPosition(cc.v2(x, y + 16));\n            bulletNode.getComponent(\"bullet\").fly();\n        }\n    },\n    /**\n     * 切换武器\n     */\n    switchBulletType() {\n        this.bulletType = this.bulletType ? 0 : 1;\n    }\n});\n"]}